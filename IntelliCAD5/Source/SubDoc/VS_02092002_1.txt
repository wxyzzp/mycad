

--------------------------------------------------------------------------------

	Submission Document for IntelliCAD

File Name:	VS_02092002_1.txt
Date:		02-09-2002
Developer:	Vittalbabu Srinivasan
Company:	Mantra Software
Reference:	

New files:	
		None

Changed files: 	
		Source/prj/lib/db/handtable.h
		Source/prj/lib/db/handtable.cpp
                Source/prj/make/db.dsp                        
 
Deleted files:	
		None

Description:	Performance improvement in HandleTable::Find().
Comments:	This submission improves performance of HandleTable::Find() by 2X. The improvement is present when there are
		a large number of handles and HandleTable::Find() is called a lot of times. This happens when dwg files are opened and 
		CIcadDoc::OnOpenDocument() calls drw_openfile() which ends up calling drw_makeeentlist(0 which calls db_drawing_handent()
		which calls HandleTable::Find(). The problem is ICAD is adding entries to a list, sorts the list (via qsort) and then
		does a search on this list. When this loop is repeated a lot of times qsort becomes extremely slow. qsort behaves very poorly when
		sorting a nearly sorted list.

		As an example, drawing demo_.dwg, makes ~7000 calls to HandleTable::Find(). This triggers (through the qsort function) more than 5Billion calls
		to the compare function. Open of this dwg file is slow.

		The fix is to use an STL map to store the db_handitem and db_objhandle relationship. This improves load time of demo_dwg
		by 200% -- the new code takes 1/3 of the time to load the demo_.dwg file as the old code.



File by File:	
		Source/prj/lib/db/handtable.h			Version: 1.1.1.1.14.1
			Replaced HandleArray with a Handle_MAP m_map instance. Added a new typedef for Handle_MAP (which is a STL map) and added a compare
			function for the key (db_objhandle).
		Source/prj/lib/db/handtable.cpp			Version:1.2.6.1
			In handTable.Add9), the new value is added to m_map. In Find() this is queried to get the value for the
			key.
                Source/prj/make/db.dsp                          Version:1.13.4.2
                        Removed treat warnings as errors. I cannot suppress Microst C4768 warnings even with a pragma.


-----------------------------------------------------------------------------
